<html>
<head>
<meta charset="utf-8">
<title>Project 3</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js" charset="utf-8"></script>

<style type="text/css">
</style>
</head>
<header id="pageTitle">General Social Survey '14 </header>
<text id="menu">Income</text>
<text id="menu">Education</text>
<text id="menu">Attitudes</text>
<img src="arrow.jpg" onclick = "rearrangeCir();" style="cursor:pointer;position: absolute; left: 550px; top: 300px;width:60px;height:60px;" ></img>
<body>
<script>
//load data file
//select 100 rows, based on random numbers generated by code --> and maybe save it somewhere else. 
//first of all, load file with columns related to income
//check year column, and based on that column, save data into separate arrays. 

var rowNumber = [758, 2003, 1333, 29, 320, 2234, 1340, 250, 2195, 518, 1285, 270, 728, 1942, 706, 60, 519, 1794, 427, 1228, 2444, 1803, 1099, 1641, 467, 814, 2399, 1814, 76, 203, 1480, 1793, 1556, 1433, 1914, 2455, 355, 2100, 1007, 1846, 845, 1044, 954, 136, 209, 2094, 881, 2209, 2440, 878, 2452, 939, 2060, 783, 1700, 865, 992, 1895, 1439, 501, 1194, 150, 662, 908, 1110, 236, 1635, 2193, 391, 119, 2389, 991, 2281, 1666, 152, 872, 1355, 289, 997, 2268, 451, 1036, 1508, 2037, 548, 1823, 2372, 1225, 2532, 1423, 517, 1781, 2189, 1550, 319, 1513, 2052, 2528, 116, 894]
//var familyIncome16 = [];
var familyIncome16From0 = [];

//max value of income2000Max
var income2000 = [];

var rearrange = false;

Papa.parse('data2014(processed).csv', {
			download: true,
			header: true,
			dynamicTyping: true,
			complete: function(results) 
			{
				// loop through all the rows in file
				//at the same time, use if statement to save only income data and so on
				for (var i=0; i < rowNumber.length; i++)
				{
					var record = results.data[rowNumber[i]];
					var income16Array = {
					    name: record.ID,
						rowNum : rowNumber[i],
						income16: record.INCOM16,
						incomeNow: record.INCOME,
						incomeNumber2000: record.CONINC,
						incomeNumber2000Pro: 0,
						degreeMe: record.DEGREE,
						degreeP: record.PADEG,
						degreM: record.MADEG,
						momWorked: record.MAWRKGRW,
						womenWorking: record.FEFAM,
						confidencePress: record.CONPRESS,
						confidenceLaw: record.CONJUDGE,
						confidenceCongress: record.CONLEGIS
					}
					//familyIncome16[income16Array.rowNum] = income16Array;
					familyIncome16From0[i] = income16Array;
					income2000[i] = income16Array.incomeNumber2000;
				}//console.log(familyIncome16)
				income2000Max(familyIncome16From0);
				drawCircle(familyIncome16From0, rowNumber);
			}//has to insert number in number row aarray
})
//----------------data load ends here--------------------

//then call data from such arrays and draw circles
//give physical movements
//the arrow is shining + changing in size
//upon clicking the arrow, draw same circles and they move to adjust
function drawCircle(familyIncome16From0, rowNumber) {
var svgW = 1500;
var svgH = 1000;

var svg = d3.select("body")
            .append("svg")
            .attr("width", svgW)
            .attr("height", svgH);

//make an array that contains possible x values (may be refreshed every time the function is called)
var min = Math.ceil(50);
var max = Math.floor(400);

var padding = 75;
var xValue = [];
var xValue1 = [];	
var xValue2 = [];	

var circle1 = svg.selectAll("circle") 
   .data(familyIncome16From0)
   .enter()
   .append("circle")	
	.attr("cx", function(d, i){
		var a = Math.floor(Math.random() * (max - min)) + min;
		xValue[i] = a;
		return a;
   })
	.attr("cy", function(d, i) {
        //based on the number of levels
		return svgH - familyIncome16From0[i].income16 * padding})
		//return familyIncome16[rowNumber[i]].income16 * padding})
		//y value + padding		
	.attr("r", 8) 
	.attr("fill", function(d,i){
		if(familyIncome16From0[i].income16 == 5) {
		return "#ffeda0"}
		else if(familyIncome16From0[i].income16 == 4) {
		return "#fd8d3c"}
		else if(familyIncome16From0[i].income16 == 3) {
		return "#fc4e2a"}
		else if(familyIncome16From0[i].income16 == 2) {
		return "#e31a1c"}
		else if(familyIncome16From0[i].income16 == 1) {
		return "#b10026"}
		else if(familyIncome16From0[i].income16 == 7) {
		return "#df65b0"}
		else if(familyIncome16From0[i].income16 == 8) {
		return "#737373"}
		else if(familyIncome16From0[i].income16 == 9) {
		return "#737373"}	
	})
	.attr("transform", "translate(0, -500)");
	//.attr("stroke", "black")

svg.selectAll("circle")
	.data(xValue)
   .transition()
	.each("start", function repeat() {
	if(rearrange == false) {
		d3.selectAll("circle")
		   .transition()
		   .duration(3000)
		   .ease("backs")
            .attr("cx", function(d, i) {
			xValue2[i] = xValue[i] + ((Math.random() - 0.5) * 30);
			return xValue2[i]})
			.attr("cy", function(d, i) {		
			return (svgH - familyIncome16From0[i].income16 * padding) + (Math.random() - 0.5) * 30})
          .transition()
		  .duration(3000)
		  .ease("backs")
            .attr("cx", function(d, i) {
			xValue1[i] = xValue2[i] + ((Math.random() - 0.5) * 30);
				return xValue1[i]})
			.attr("cy", function(d, i) {		
				return (svgH -familyIncome16From0[i].income16 * padding) + (Math.random() - 0.5) * 30})
          .transition()
            .each("start", repeat);}
			
	else if(rearrange == true) {
		d3.selectAll("circle")
		   .transition()
		   .duration(3000)
		   .ease("backs")
            .attr("cx", function(d, i) {
			if (familyIncome16From0[i].incomeNow < 13) {
				xValue2[i] = xValue[i] + ((Math.random() - 0.5) * 30);
				return xValue2[i] + 500}
			else {
				return  1200 + (Math.random() - 0.5) * 30;}
			})
			.attr("cy", function(d, i) {
				if(familyIncome16From0[i].incomeNumber2000Pro == 0) {return 800 + (Math.random() - 0.5) * 30;}
				else {return (svgH -familyIncome16From0[i].incomeNumber2000Pro * padding) + (Math.random() - 0.5) * 30}
				})
			//because one possible answer is 98 or more
			/*if (familyIncome16From0[i].incomeNow < 13) {
				//if multiple of 2, minus 1, in order to aggreagate by 2 levels
				if (familyIncome16From0[i].incomeNow % 2 == 0) {
					return (svgH - ((familyIncome16From0[i].incomeNow) - 1) * padding/2) + (Math.random() - 0.5) * 30}
				else {
					return (svgH - familyIncome16From0[i].incomeNow * padding/2) + (Math.random() - 0.5) * 30;}
				}
			else {
				return  800 + (Math.random() - 0.5) * 30;}})*/
          .transition()
		  .duration(3000)
		  .ease("backs")
            .attr("cx", function(d, i) {
			if (familyIncome16From0[i].incomeNow < 13) {
				xValue1[i] = xValue2[i] + ((Math.random() - 0.5) * 30);
				return xValue1[i] + 500}
			else {
				return  1200 + (Math.random() - 0.5) * 30;}	
			})
			.attr("cy", function(d, i) {
				if(familyIncome16From0[i].incomeNumber2000Pro == 0) {return 800 + (Math.random() - 0.5) * 30;}
				else {return (svgH -familyIncome16From0[i].incomeNumber2000Pro * padding) + (Math.random() - 0.5) * 30}
				})
          .transition()
            .each("start", repeat);}	
	
      }); 
	  }
//this function triggered upon click of arrow
//another transition. the circles are moved to the other side of arrow
function rearrangeCir() {
	rearrange = true;
} 
function income2000Max(familyIncome16From0)  {
	var level = Math.floor(d3.max(income2000)) / 5;
	for (i=0;i<familyIncome16From0.length;i++){
		if (familyIncome16From0[i].incomeNumber2000 < level){familyIncome16From0[i].incomeNumber2000Pro = 1}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 2){familyIncome16From0[i].incomeNumber2000Pro =  2}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 3){familyIncome16From0[i].incomeNumber2000Pro =  3}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 4){familyIncome16From0[i].incomeNumber2000Pro =  4}
		else if (familyIncome16From0[i].incomeNumber2000 >= level * 4){familyIncome16From0[i].incomeNumber2000Pro = 5}
	} 
	
}

</script>
</body>

</html>
