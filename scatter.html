<html>
<head>
<meta charset="utf-8">
<title>Project 3</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js" charset="utf-8"></script>

<style type="text/css">
text { 
			font-family: Arial; 
			font-size: 15px;
		}
		.axis path, .axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		.tick text {
			fill: black;
			font-size: 11px;
		}
		  .lines {
            stroke: black;
        }
.axis {
	fill: none;
	stroke: grey;
	shape-rendering: crispEdges;
		
}
.chartLabel		{
	font-size: 13px;
}
.axisLabel		{
	font-size: 11px;
}
.menu{
	cursor:pointer;
	position: absolute;
	top : 50px;
	font-size: 18px;
}
.submenu{
	cursor:pointer;
	position: absolute;
	top : 54px;
	font-size: 13px;
}
a:link {
    text-decoration: none;
	color: black;
}

a:visited {
    text-decoration: none;
	color: black;
}
</style>
</head>
<text class="pageTitle" id="pageTitle" style="font-size: 25px;position: absolute; left: 350px; top: 10px;" >Responder Highest Degree with Other Variables</text>
<a href= "https://239cda.github.io/Project3/home.html"text class="menu" style="positon:absolute; left: 350px;">Back to Top</text></a>
<text class="menu" onclick ="" style="positon:absolute; left: 550px;">Explore</text>
<a href= "https://239cda.github.io/Project3/timechart.html" text class="submenu" style="positon:absolute; left: 660px;">By Time</text></a>
<a href= "https://239cda.github.io/Project3/scatter.html"text class="submenu" style="positon:absolute; left: 750px;">By Variables</text></a>

<select id="drop1" style="position: absolute;left: 800px;top: 700px">
<option >Father Highest Degree</option>
<option>Mother Highest Degree</option>
<option>Spouse Highest Degree</option>
<option selected="selected">Responder Highest Degree</option>
<option>Family Income Level at 16</option>
<option>Current Income Level</option>
<option>Type of region lived at 16</option>]
<option>View on Role of Men and Women</option>
<option>View on Working Mother</option>
<option>Confidence in Press</option>
<option>Confidence in Law</option>
<option>Confidence in Congress</option>
<option>Gov. spending on environment</option>
<option>Gov. spending on education</option>
<option>Gov. on reducing income gap</option>
<option>Belief in God</option>
<option>Level of Happiness</option>
</select>

<select id="drop2" style="position: absolute;left: 800px;top: 750px">
<option >1972</option>
<option>1976</option>
<option>1980</option>
<option selected="selected">1984</option>
<option>1988</option>
<option>1993</option>
<option>1996</option>]
<option>2000</option>
<option>2004</option>
<option>2006</option>
<option>2010</option>
<option selected="selected">2014</option>
</select>

<body>
<script>
//load data file
//select 100 rows, based on random numbers generated by code --> and maybe save it somewhere else. 
//first of all, load file with columns related to income
//check year column, and based on that column, save data into separate arrays. 

//var familyIncome16 = [];
var dataset = [];
var datasetP = [];	
var years = [1972, 1976, 1980, 1984, 1988, 1993, 1996, 2000, 2004, 2006, 2010, 2014];
//max value of income2000Max
var income2000 = [];
var totalVar = ["degreeP", "degreeM","degreeS","degreeMe", "income16","incomeNumber2000Pro","whereLived16","womenWorking",
"workingMother","confidencePress","confidenceLaw","confidenceCongress","environment","educationImprove","equalW", "isGod","isHappy"];
var totalCaption = ["Father highest degree", "Mother highest degree", "Spouse highest degree","Responder highest degree",
"Family income at 16","Current household income","Place lived at 16(from rural area to big city)","Traditional gender role",
"View on Working Mother","Confidence in press","Confidence in law","Confidence in congress","Gov. spending on environment",
"Gov. spending on education","Gov. on reducing income gap","Belief in God","Happiness"];

var svgW = 300;
var svgH = 300;
var chartW = 100;
var chartH = 100;

var padding = 15;
var opacity = 0.05;

Papa.parse('TotalData150P.csv', {
			download: true,
			header: true,
			dynamicTyping: true,
			complete: function(results) 
			{
				// loop through all the rows in file
				//at the same time, use if statement to save only income data and so on
				for (var i=0; i < results.data.length; i++)
				{
					var record = results.data[i];
					var income16Array = {
					    name: record.ID,
						year: record.YEAR,
						//rowNum : rowNumber[i],
						income16: record.INCOM16,
						incomeNumber2000: record.CONINC,
						incomeNumber2000Pro: 0,
						degreeMe: record.DEGREE,
						degreeP: record.PADEG,
						degreeM: record.MADEG,
						degreeS: record.SPDEG,
						momWorked: record.MAWRKGRW,
						womenWorking: record.FEFAM,
						workingMother : record.FECHLD,
						confidencePress: record.CONPRESS,
						confidenceLaw: record.CONJUDGE,
						confidenceCongress: record.CONLEGIS,
						isGod: record.GOD,
						isHappy:record.HAPPY,
						environment:record.NATENVIY,
						equalW: record.EQWLTH,
						abortion:record.ABANY,
						cap: record.CAPPUN,
						whereLived16: record.RES16,
						educationImprove: record.NATEDUCY
					}
					dataset[i] = income16Array;
					income2000[i] = income16Array.incomeNumber2000;
				}

				income2000Max(dataset);
				//create subfile for each year
				datasetSub(dataset, 2014);
				variableForScatter("degreeMe");
			}//has to insert number in number row aarray
})
//----------------data load ends here--------------------

//then call data from such arrays and draw circles
//give physical movements
//the arrow is shining + changing in size
//upon clicking the arrow, draw same circles and they move to adjust
	d3.select("#drop1")
				   .on('change', function(){
					   var selection = document.getElementById('drop1');
					   var selectedVariable= selection.options[selection.selectedIndex].value;
					   var selectedIndex = document.getElementById("drop1").selectedIndex;
						
					   variableForScatter(totalVar[selectedIndex]);
						})
	d3.select("#drop2")
				   .on('change', function(){
					   var selection = document.getElementById('drop2');
					   var selectedVariable= selection.options[selection.selectedIndex].value;
					    var selectedIndex = document.getElementById("drop1").selectedIndex;
					   datasetP = [];
					   datasetSub(dataset, selectedVariable);
					   variableForScatter(totalVar[selectedIndex]);
						})
function drawCircle(variable, variable2) {
var totalVar = ["degreeP", "degreeM","degreeS","degreeMe", "income16","incomeNumber2000Pro","whereLived16","womenWorking",
"workingMother","confidencePress","confidenceLaw","confidenceCongress","environment","educationImprove","equalW","isGod","isHappy"];

var domainX = 0;
var domainY = 0;

var xText = "High";
var yText = "High";

var textArray = ["High", "Low", "Positive", "Negative"];

function scaleValues(variable) {
if(variable == "income16") {
	domainX = 1;
	domainY = 5;
}
else if (variable == "whereLived16") {
	domainX = 1;
	domainY = 6;
}
//1 means strongly agree
else if(variable == "womenWorking") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "workingMother") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "confidencePress") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "confidenceLaw") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "confidenceCongress") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "confidenceCongress") {
	domainX = 1;
	domainY = 4;
}
else if(variable == "environment") {
	domainX = 1;
	domainY = 3;
}
else if(variable == "educationImprove") {
	domainX = 1;
	domainY = 3;
}
//1 means shoud. 7 means shoudl not.
else if(variable == "equalW") {
	domainX = 1;
	domainY = 7;
}
else if(variable == "isGod") {
	domainX = 1;
	domainY = 6;
}
else if(variable == "isHappy") {
	domainX = 1;
	domainY = 3;
}
else {
	domainX = 0;
	domainY = 4;
}

}

scaleValues(variable);
var yScale = d3.scale.linear()
				.domain([domainX, domainY])
				.range([chartH , padding]);

scaleValues(variable2);
var xScale = d3.scale.linear()
				.domain([domainX, domainY])
				.range([padding, chartW]);

	var svg = d3.select("body")
            .append("svg")
            .attr("width", svgW)
            .attr("height", svgH)
			.attr("transform","translate(100,0)")
			
	var circle1 = svg.selectAll("circle") 
	.data(datasetP)
	.enter()
	.append("circle")	
	.attr("cx", function(d){ 
		var result = d[variable2];
		xText = "High";
		//console.log(datasetP[variable2])
		if(variable2 == "income16") {
			xText = "High";
			if (result < 1) {return 500;}
			else if (result <= 5) {
			return xScale(result)
		}
		}
		else if (variable2 == "whereLived16") {
			xText = "Big city";
			if (result < 1) {return 500;}
			else if (result <=6) {
			return xScale(result)
		}
		}
		//1 means strongly agree
		else if(variable2 == "womenWorking") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
		}
		else if(variable2 == "workingMother") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
		}
		else if(variable2 == "confidencePress") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
		}
		else if(variable2 == "confidenceLaw") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
		}
		else if(variable2 == "confidenceCongress") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
		}
		else if(variable2 == "environment") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=3) {
			return xScale(result)
		}
		}
		else if(variable2 == "educationImprove") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=3) {
			return xScale(result)
		}
		}
		//1 means shoud. 7 means shoudl not.
		else if(variable2 == "equalW") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=7) {
			return xScale(result)
		}
		}
		else if(variable2 == "isGod") {
			xText = "Positive";
			if (result < 1) {return 500;}
			else if (result <=6) {
			return xScale(result)
		}
		}
		else if(variable2 == "isHappy") {
			xText = "Negative";
			if (result < 1) {return 500;}
			else if (result <=3) {
			return xScale(result)
		}
		}
		else {
			xText = "High";
			if (result < 0) {return 500;}
			else if (result <=4) {
			return xScale(result)
		}
			else {return 500;}
		}
    })
	.attr("cy", function(d) {
	var result = d[variable];
	//y value is mother's education level for every chart
		if(variable == "income16") {
			yText = "High";
			if (result < 1) {return 500;}
			else if (result < 5) {
			return yScale(result)
		}
		}
		else if (variable == "whereLived16") {
			yText = "Big City";	
			if (result < 1) {return 500;}
			else if (result <=6) {
			return yScale(result)
		}
		}
		//1 means strongly agree
		else if(variable == "womenWorking") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
		}
		else if(variable == "workingMother") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
		}
		else if(variable == "confidencePress") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
		}
		else if(variable == "confidenceLaw") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
		}
		else if(variable == "confidenceCongress") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
		}
		else if(variable == "environment") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=3) {
			return yScale(result)
		}
		}
		else if(variable == "educationImprove") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=3) {
			return yScale(result)
		}
		}
		//1 means shoud. 7 means shoudl not.
		else if(variable == "equalW") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=7) {
			return yScale(result)
		}
		}
		else if(variable == "isGod") {
			yText = "Positive";	
			if (result < 1) {return 500;}
			else if (result <=6) {
			return yScale(result)
		}
		}
		else if(variable == "isHappy") {
			yText = "Negative";	
			if (result < 1) {return 500;}
			else if (result <=3) {
			return yScale(result)
		}
		}
		else {
			yText = "High";	
			if (result < 0) {return 500;}
			else if (result <=4) {
			return yScale(result)
		}
			else {return 500;}
		}

})
	.attr("r", 10) 
	.attr("fill", "#b20062")
	.style("fill-opacity", opacity)		
	.attr("class", "dots")	
	.on("mouseover", function(d, i) {
          tooltip.transition()
               .duration(200)
               .style("opacity", .9);
          tooltip.html("Highest Degree Earned" + "<br/> Responder: " + legendTextIncome16[familyIncome16From0[i]["degreeMe"]]+"<br/>Father: " + legendTextIncome16[familyIncome16From0[i]["degreeP"]] + "<br/>Mother: " + legendTextIncome16[familyIncome16From0[i]["degreeM"]])
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
          tooltip.transition()
               .duration(500)
               .style("opacity", 0);
      })	
	
	.attr("transform", "translate(0, 100)")

var index = totalVar.indexOf(variable2)	
var indexYaxis = totalVar.indexOf(variable)	

var lineX = svg.append("line")
                        .attr("x1", 0)
                        .attr("y1", chartH * 2)
                       .attr("x2", chartW)
                        .attr("y2", chartH * 2)
                        .attr("class", "axis")
var lineY = svg.append("line")
                        .attr("x1", 0)
                        .attr("y1", chartH * 2)
                       .attr("x2", 0)
                        .attr("y2", chartH)
                        .attr("stroke-width", 1)
                        .attr("class", "axis");		
svg.append("text")
	.attr("class", "axisLabel")
	.text(yText)
	.attr("x", 0)
	.attr("y", chartH - 10)
//.attr("transform", "translate(0, 100)")

svg.append("text")
	.attr("class", "axisLabel")
	.text(xText)
	.attr("x", chartW + 10)
	.attr("y", chartH * 2 + 5)
//.attr("transform", "translate(0, 100)")


						
svg.append("text")
	.attr("class", "chartLabel")
	.text("x Axis: " + totalCaption[index])
	.attr("x", 0)
	.attr("y", chartH + 30)
.attr("transform", "translate(0, 100)")

svg.append("text")
	.attr("class", "chartLabel")
	.text("y Axis: " + totalCaption[indexYaxis])
	.attr("x", 0)
	.attr("y", chartH + 30)
.attr("transform", "translate(0, 120)")

}

function income2000Max(familyIncome16From0)  {
	var level = Math.floor(d3.max(income2000)) / 5;
	for (i=0;i<familyIncome16From0.length;i++){
		if (familyIncome16From0[i].incomeNumber2000 < level){familyIncome16From0[i].incomeNumber2000Pro = 0}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 2){familyIncome16From0[i].incomeNumber2000Pro =  1}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 3){familyIncome16From0[i].incomeNumber2000Pro =  2}
		else if (familyIncome16From0[i].incomeNumber2000 < level * 4){familyIncome16From0[i].incomeNumber2000Pro =  3}
		else if (familyIncome16From0[i].incomeNumber2000 >= level * 4){familyIncome16From0[i].incomeNumber2000Pro = 4}
	} 
	
}
function datasetSub(dataset, year) {			
	for (i=0;i<dataset.length;i++){
	if(dataset[i].year == year) {
	datasetP.push(dataset[i]);
	//when changing year, refresh this dataset
	}
}
}
function variableForScatter(selectedVariable) {
	d3.select("body").selectAll('svg').remove();
	//d3.select("body").selectAll('circle').remove();
					for(i=0;i<totalVar.length;i++) {
					
					drawCircle(selectedVariable, totalVar[i]);
					}
				}

</script>
</body>

</html>
